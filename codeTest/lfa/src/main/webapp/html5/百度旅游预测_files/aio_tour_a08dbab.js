$.extend(T,{Util:{format:function(r){return params=[].slice.call(arguments,1),1==params.length&&"[object Object]"==String(params[0])&&(params=params[0]),r.replace(/(#|\=)\{(\w+)\}/g,function(r,e,n){var t=params[n];return void 0===t?"":"="===e?t:"#"===e?t:void 0})},encodeHTML:function(r){return String(r).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")},formatNumber:function(r){r=String(r);for(var e=/(-?\d+)(\d{3})/;e.test(r);)r=r.replace(e,"$1,$2");return r},indexOf:function(r,e){if(null==r)return-1;var n=Array.prototype.indexOf;if(n&&r.indexOf===n)return r.indexOf(e);for(var t=0,a=r.length;a>t;t++)if(r[t]===e)return t;return-1},contains:function(r,e){return-1!=this.indexOf(r,e)},clickInContainer:function(r,e){for(;;){if(r===e)return!0;if(r=r.parentNode,null===r)return!1}}}});
;var TravelMap={init:function(t){var i={minZoom:5,maxZoom:14,zoomStep:1,startZoom:5,scenicZoom:12,provinceZoom:8,countryZoom:5,useSVG:window.SVGAngle||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"),startPoint:{x:104.114129,y:37.550339},mapStyle:{features:["road","building","water","land"],style:"dark"},zoomControlPosition:{at:BMAP_ANCHOR_TOP_LEFT,x:15,y:20},legendPosition:{at:BMAP_ANCHOR_BOTTOM_RIGHT,x:335,y:58}};return this.options=$.extend(!0,{},i,t),this.initMap(),this.initLegend(),this.initZoom(),this.initTip(),this},setLegendOffset:function(t,i){var t="number"==typeof t?t:this.legend.getOffset().width,i="number"==typeof i?i:this.legend.getOffset().height;this.legend.setOffset(new BMap.Size(t,i))},showLogo:function(){this.logo=new LogoOverlay({point:new BMap.Point(103.378237,46.48799)}),this.map.addOverlay(this.logo)},initMap:function(){var t=new BMap.TileLayer,i=T.config.systemConfig.mapTileUrl;t.getTilesUrl=function(t,e){var o=i+"&x="+t.x+"&y="+t.y+"&z="+e+"&styles=pl";return o};var e=new BMap.MapType("线下测试",t),o=new BMap.Map("map-container",{enable3DBuilding:!1,vectorMapLevel:99,mapType:e}),n=this.options.mapStyle;o.setMapStyle(n),o.getContainer().style.background="rgb(48,56,69)",o.setMinZoom(this.options.minZoom),o.setMaxZoom(this.options.maxZoom);var s=o.overlayPixelToPoint(new BMap.Pixel(320,0)),a=new BMap.Point(this.options.startPoint.x-s.lng/2,this.options.startPoint.y);o.centerAndZoom(a,this.options.startZoom),1===this.options.zoomStep&&(o.enableScrollWheelZoom(),o.enableKeyboard(),o.enableContinuousZoom()),o.enableInertialDragging(),o.disable3DBuilding(),o.addEventListener("click",$.proxy(this,"hideTip")),o.addEventListener("zoomend",$.proxy(this.options,"zoomChange")),this.map=o},initTip:function(){this.tip=new TipOverlay,this.tip.viewTrends=$.proxy(this.options,"viewTrends"),this.tip.viewProvince=$.proxy(this.options,"viewProvince"),this.map.addOverlay(this.tip)},initLegend:function(){this.legend=new LegendOverlay({position:this.options.legendPosition}),this.map.addControl(this.legend)},initZoom:function(){this.zoom=new ZoomControl({position:this.options.zoomControlPosition,minZoom:this.options.minZoom,maxZoom:this.options.maxZoom,zoomStep:this.options.zoomStep}),this.map.addControl(this.zoom)},setCenterOffset:function(t){var i=this.map.overlayPixelToPoint(new BMap.Pixel(320,0)),e=this.map.overlayPixelToPoint(new BMap.Pixel(0,0)),o=this.map.getCenter();this.closed=t,t?this.map.panTo(new BMap.Point(o.lng+(e.lng-i.lng)/2,o.lat)):this.map.panTo(new BMap.Point(o.lng-(e.lng-i.lng)/2,o.lat))},getOffset:function(t){if("scenic"===t)var i=$(window).height(),e=i-440;else var e=140;var o=this.map.pixelToPoint(new BMap.Pixel("scenic"===t?500:320,e)),n=this.map.pixelToPoint(new BMap.Pixel(0,0)),s=0;this.closed||(s=(n.lng-o.lng)/2);var a=(n.lat-o.lat)/2;return{x:s,y:a}},addMarker:function(t,i){var e={heat1:"/static/trends_travel/image/tour/heat-1_d1ae9c3.png",heat2:"/static/trends_travel/image/tour/heat-2_3d068de.png",heat3:"/static/trends_travel/image/tour/heat-3_5275d9c.png",heat4:"/static/trends_travel/image/tour/heat-4_b4216d2.png",heat5:"/static/trends_travel/image/tour/heat-5_6628867.png"},o=e["heat"+t.heat],n=new BMap.Size(16,i?16:66),s=new BMap.Point(t.x,t.y),a=new BMap.Size(5,i?0:-23),r=new BMap.Icon(o,n),p=this.options.useSVG?new Bubble(t):new TopMarker(t),h=i?new BMap.Marker(s,{icon:r,offset:a,title:t.label}):p;return h.addEventListener("click",$.proxy(this,"focusScenicAndShowTip",t)),this.map.addOverlay(h),h},clearPointMarkers:function(){if(this.pointMarkers)for(var t=0;t<this.pointMarkers.length;t++){var i=this.pointMarkers[t];i.dealloc&&i.dealloc(),this.map.removeOverlay(i)}this.pointMarkers=[]},render:function(t,i,e,o){this.data=t,this.clearPointMarkers();for(var n=[1,5,19,28,16,18,25,32,4,17,2,27],s=0,a=0;a<n.length;a++)i===n[a]&&(s=1);if(o||this.hideTip(),t&&0!==t.length)for(var a=t.length-1;a>=0;a--){var r=t[a];this.pointMarkers.push(this.addMarker(r,e||(s?a>4:a>9)))}},zoomChangeRender:function(t){t==this.map.getZoom()+1?this.render(this.data,!0,!0):t==this.map.getZoom()&&this.render(this.data,!1,!0)},setZoom:function(t){this.map.setZoom(t)},focusScenic:function(t){var i=this.getOffset("scenic");this.map.panTo(new BMap.Point(t.x-i.x,t.y-i.y)),this.options.afterFocusScenic&&this.options.afterFocusScenic(t)},focusScenicAndShowTip:function(t,i){window._hmt&&_hmt.push(["_trackEvent","地图","点击景点",t.label]),this.focusScenic(t),this.showTip(t,i)},focusProvince:function(t){this.map.setZoom(t.zoom||("全国"===t.label?this.options.countryZoom:this.options.provinceZoom));var i=this.getOffset();this.map.panTo(new BMap.Point(t.x-i.x,t.y-i.y))},showTip:function(t,i){this.currentScenic=t,this.tip.show(t),i&&$.event.fix(i.domEvent||i).stopPropagation()},showTrends:function(t,i,e){this.tip.showTrends(t,i,e)},hideTip:function(){this.currentScenic=null,this.tip.hide()},isShowTip:function(){return this.tip.isShowTip()},getCurrentScenicId:function(){return this.currentScenic?this.currentScenic.id:null}};
;function TipOverlay(){}TipOverlay.prototype=new BMap.Overlay,TipOverlay.prototype.weather={"晴":"sunny","多云":"cloudy","阴":"overcast","阵雨":"shower","雷阵雨":"thundershower","雷阵雨伴有冰雹":"thundershower-with-hail","雨夹雪":"sleet","小雨":"l-rain","中雨":"m-rain","大雨":"h-rain","暴雨":"storm","大暴雨":"h-storm","特大暴雨":"s-storm","阵雪":"snow-flurry","小雪":"l-snow","中雪":"m-snow","大雪":"h-snow","暴雪":"snowstorm","雾":"foggy","冻雨":"ice-rain","沙尘暴":"duststorm","小到中雨":"l2m-rain","中到大雨":"m2h-rain","大到暴雨":"h-rain2storm","暴雨到大暴雨":"storm2h-storm","大暴雨到特大暴雨":"h2s-storm","小到中雪":"l2m-snow","中到大雪":"m2h-snow","大到暴雪":"h-snow2snowstorm","浮尘":"dust","扬沙":"sand","强沙尘暴":"sandstorm","霾":"haze","未知":"unknown"},TipOverlay.prototype.comfortLevel={1:"非常舒适",2:"舒适",3:"一般",4:"拥挤",5:"非常拥挤"},TipOverlay.prototype.initialize=function(t){this._map=t;var e=$('<div id="info-panel" class="info-panel" style="position:absolute;display:none"></div>');e.html($("#tip-info-tpl").html().replace(/>\s+</g,"><"));var a=this;e.find(".close").click(function(){a.hide()}),e.on("click",".view-trend",function(){a.viewTrends&&a.viewTrends(a._info.id),$("#info-panel").addClass("show-trend")}),e.on("click",".view-overview",function(){$("#info-panel").removeClass("show-trend")}),e.on("click",".view-province",function(){a.viewProvince&&a.viewProvince($(this).data("province"))}),e.on("click dblclick",function(t){t.stopPropagation()});var i=e.get(0);return t.getPanes().floatPane.appendChild(i),this._div=i,i},TipOverlay.prototype.draw=function(){if(this._info){var t=this._map.pointToOverlayPixel(new BMap.Point(this._info.x,this._info.y));this._div.style.left=t.x+18+"px",this._div.style.top=t.y-18+"px"}},TipOverlay.prototype.show=function(t){if($("#info-panel").removeClass("show-trend"),this._info=t,this.draw(),$(this._div).show(),t){$("#info-panel").find(".name").text(t.label);var e="";if(e+=t.realtime&&t.uid?'<div class="data-label">今日拥挤指数</div>':'<div class="data-label">百度拥挤指数</div>',t.closed)e+='<span class="data-empty">今日闭馆</span>';else if(e+=T.Util.format('<div class="data-heat">#{0}</div><span class="data-comfort data-comfort-#{0}">#{1}</span>',t.heat,this.comfortLevel[t.heat]),t.uv&&(e+='<div class="data-uv">'+(t.real?"实际":"预测")+"游览人数："+T.Util.formatNumber(t.uv)+"</div>"),t.realtime&&t.uid){var a="http://map.baidu.com/heatmap/index/detail/qt=inf&uid="+t.uid+"/time="+(new Date).getTime()+"&from=yuce&tpl=map_singlepoint_hot";e+='<div class="heat-chart-link"><a href="'+a+'" target="_blank">查看实时拥挤度&gt;&gt;</a></div>'}$("#heat-data-section").html(e);var i='<div class="data-label">天气</div>';i+=null==t.weather||"未知"==t.weather?'<span class="data-empty">暂无天气信息</span>':T.Util.format('<div class="weather-icon weather-#{0}" title="#{3}"></div>                            <span class="data-weather">空气：#{1}</span>                            <div class="data-temperature">#{2}</div>',this.weather[t.weather.split("转")[0]],t.aq,t.temperature,t.weather),$("#weather-data-section").html(i),t.nationwide?$("#view-data-section").html(T.Util.format("<a class=\"view-province view-province-nationwide\" href=\"javascript:void(0)\" data-province=\"#{2}\" onclick=\"_hmt.push(['_trackEvent', '景点信息Tip', '查看全部景点', '#{1}']);\">#{1}全部景点&nbsp;&nbsp;&gt;</a><a class=\"view-trend view-trend-nationwide\" href=\"javascript:void(0)\" onclick=\"_hmt.push(['_trackEvent', '景点信息Tip', '查看30天景点拥挤状况', '#{0}']);\">30天趋势&nbsp;&nbsp;&gt;</a>",t.label,t.province,t.provinceId)):$("#view-data-section").html(T.Util.format("<a class=\"view-trend\" href=\"javascript:void(0)\" onclick=\"_hmt.push(['_trackEvent', '景点信息Tip', '查看30天景点拥挤状况', '#{0}']);\">查看30天景点拥挤状况&nbsp;&nbsp;&gt;</a>",t.label))}this.showTipStatus=!0},TipOverlay.prototype.hide=function(){this._div&&$(this._div).hide(),this.showTipStatus=!1},TipOverlay.prototype.isShowTip=function(){return this.showTipStatus},TipOverlay.prototype.viewTrends=function(){},TipOverlay.prototype.viewProvince=function(){},TipOverlay.prototype.showTrends=function(t,e,a){for(var i=t[0],s=t[1],o=2,n=new Date(a-864e5*i.length),r=new Date(a+864e5*(o-Math.ceil(s.length/2))),l=new Date(a+864e5*o),h=(Math.floor((a-e)/864e5),Math.max(Math.max.apply(null,i),Math.max.apply(null,s))),p=115,d=7,c=p-2*d,v=285,w=s.length,f=(v-d)/(w-1),m="",u="",y=0;y<i.length;y++)m+="L"+Math.ceil(y*f)+","+Math.ceil(d+c-i[y]*c/h);for(var g,k,x="M"+m.substring(1),y=0;y<s.length;y++){var _=Math.ceil(y*f),b=Math.ceil(d+c-s[y]*c/h);u+="L"+_+","+b,y==s.length-o-1&&(g=_,k=b)}var M="M"+u.substring(1),O="";O=window.SVGAngle||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?T.Util.format('<svg width="#{4}" height="#{5}" style="fill:none;stroke-width:2">                                <path id="real-path" d="#{0}" style="stroke:white"/>                                <path id="trend-path" d="#{1}" style="stroke:#FFD200;stroke-dasharray:2,2"/>                                <circle id="trend-circle" cx="#{2}" cy="#{3}" r="5" style="stroke:#FFD200;stroke-width:3" />                              </svg>',x,M,g,k,v,p):T.Util.format('<v:group style="width:#{4}px;height:#{5}px;position:relative" coordsize="#{4},#{5}" class="vml">                                <v:shape style="width:#{4}px;height:#{5}px" class="vml" path="#{0}" strokeColor="white" strokeWeight="1.5" filled="false"/>                                <v:shape style="width:#{4}px;height:#{5}px" class="vml" path="#{1}" strokeColor="#FFD200" strokeWeight="1.5" filled="false">                                    <v:stroke class="vml" dashstyle="dot" /></v:shape>                                <v:oval class="vml" style="width:10px;height:10px;position:absolute;top:#{3}px;left:#{2}px;" filled="false" strokecolor="#FFD200" strokeweight="2" />                              </v:group>',x,M,g-5,k-5,v,p),$("#trend-chart").html(O),$("#trend-chart-date").find(".chart-date-left").text(n.getMonth()+1+"."+n.getDate()),$("#trend-chart-date").find(".chart-date-center").text(r.getMonth()+1+"."+r.getDate()),$("#trend-chart-date").find(".chart-date-right").text(l.getMonth()+1+"."+l.getDate())};
;function TopMarker(t){this._info=t,this.initMarker()}TopMarker.prototype=new BMap.Overlay,TopMarker.prototype.colors=["#26D921","#7CB424","#FFEA35","#FF8F35","#FC341E"],TopMarker.prototype.colors2=["#17AE12","#639415","#B7A401","#BF5B0B","#952F26"],TopMarker.prototype.waves=["m 14.889992,58.069762 c 5.643461,10.011707 9.24888,15.666943 14.51866,26.083861 C 35.652796,72.516809 36.113214,72.742238 43.515243,59.816083 30.67488,65.798795 22.706731,50.246836 14.889992,58.069762 z","m 11.389992,51.944762 c 5.643461,10.011707 12.74888,21.791943 18.01866,32.208861 C 35.652796,72.516809 39.613214,67.367238 46.515243,54.316083 32.54988,41.173795 28.831731,66.621836 11.389992,51.944762 z","M 8.0312343,46.111131 C 13.674696,56.122838 25.199532,73.913482 29.408652,84.153623 35.652796,72.516809 44.032632,59.23551 50.934661,46.184355 33.582394,31.918683 21.115979,59.962583 8.0312343,46.111131 z","M 4.8492537,38.509733 C 9.2552784,49.05177 25.199532,73.913482 29.408652,84.153623 34.768913,72.516809 50.396593,50.573452 53.939864,38.93651 39.712597,20.847518 17.933998,52.361185 4.8492537,38.509733 z","M 2.5493168,30.918412 C 2.7752008,41.460449 25.199532,73.913482 29.408652,84.153623 34.768913,72.516809 55.921861,43.262461 56.106374,30.918412 39.816607,43.82942 15.960049,10.729844 2.5493168,30.918412 z"],TopMarker.prototype.waveAniPaths=[["m 14.536441,57.716205 c 5.643461,10.01171 9.24888,15.66695 14.51866,26.08386 6.244144,-11.63681 6.704562,-11.41138 14.106591,-24.33754 -12.407751,-4.709037 -13.901026,14.515281 -28.625251,-1.74632 z","m 14.536441,57.716205 c 5.643461,10.01171 9.24888,15.66695 14.51866,26.08386 6.244144,-11.63681 6.704562,-11.41138 14.106591,-24.33754 -13.503945,8.846681 -14.161434,-10.012262 -28.625251,-1.74632 z","m 14.536441,57.716205 c 5.643461,10.01171 9.24888,15.66695 14.51866,26.08386 6.244144,-11.63681 6.704562,-11.41138 14.106591,-24.33754 -12.296839,-0.620202 -18.43656,8.346757 -28.625251,-1.74632 z"],["m 11.389992,51.944762 c 5.643461,10.011707 12.74888,21.791943 18.01866,32.208861 6.244144,-11.636814 10.204562,-16.786385 17.106591,-29.83754 -18.62415,12.1026 -12.256512,-10.63749 -35.125251,-2.371321 z","m 11.389992,51.944762 c 5.643461,10.011707 12.74888,21.791943 18.01866,32.208861 6.244144,-11.636814 10.204562,-16.786385 17.106591,-29.83754 -12.249149,-6.1474 -14.006512,10.23751 -35.125251,-2.371321 z","m 11.389992,51.944762 c 5.643461,10.011707 12.74888,21.791943 18.01866,32.208861 6.244144,-11.636814 10.204562,-16.786385 17.106591,-29.83754 -16.12415,3.2276 -19.006512,-8.13749 -35.125251,-2.371321 z"],["m 8.0457597,46.390701 c 5.6434563,10.01171 17.1682833,27.80236 21.3773993,38.0425 6.24414,-11.63682 14.62398,-24.91812 21.52601,-37.96927 -13.520163,5.599081 -21.33339,-14.545248 -42.9034093,-0.0732 z","m 8.0457597,46.390701 c 5.6434563,10.01171 17.1682833,27.80236 21.3773993,38.0425 6.24414,-11.63682 14.62398,-24.91812 21.52601,-37.96927 -29.881076,-9.920248 -17.826662,15.128735 -42.9034093,-0.0732 z","m 8.0457597,46.390701 c 5.6434563,10.01171 17.1682833,27.80236 21.3773993,38.0425 6.24414,-11.63682 14.62398,-24.91812 21.52601,-37.96927 C 33.057685,62.519488 26.026945,34.668683 8.0457597,46.390731 z"],["M 4.6228498,38.548689 C 9.0288748,49.090726 24.973128,73.952438 29.182248,84.192579 34.542512,72.555765 50.170192,50.612408 53.713462,38.975466 23.6216,27.497387 28.081332,63.418683 4.6228498,38.548689 z","M 4.6228498,38.548689 C 9.0288748,49.090726 24.973128,73.952438 29.182248,84.192579 34.542512,72.555765 50.170192,50.612408 53.713462,38.975466 42.521726,48.621124 43.856458,17.584159 4.6228498,38.548689 z","M 4.6228498,38.548689 C 9.0288748,49.090726 24.973128,73.952438 29.182248,84.192579 34.542512,72.555765 50.170192,50.612408 53.713462,38.975466 34.575658,56.806153 27.79706,37.919945 4.6228498,38.548689 z"],["m 2.5739762,30.642908 c 0.22589,10.542038 22.6502208,43.0554 26.8593408,53.295541 5.36026,-11.636814 26.51321,-40.891162 26.69772,-53.235212 C 46.674582,6.846478 26.531256,47.87672 2.6989762,30.642907","m 2.5739762,30.642908 c 0.22589,10.542038 22.6502208,43.0554 26.8593408,53.295541 5.36026,-11.636814 26.51321,-40.891162 26.69772,-53.235212 C 38.368233,46.908924 32.338236,8.7854683 2.6989762,30.642907","m 2.5739762,30.642908 c 0.22589,10.542038 22.6502208,43.0554 26.8593408,53.295541 5.36026,-11.636814 26.51321,-40.891162 26.69772,-53.235212 C 36.143359,9.782138 20.903839,40.273167 2.6989762,30.642907"]],TopMarker.prototype.initMarker=function(){var t=$('<div style="position:absolute;cursor:pointer;"></div>'),i=t.get(0);this.div=i},TopMarker.prototype.initialize=function(t){function i(){v.animate({path:u[0]},500,null,a)}function a(){v.animate({path:u[1]},500,null,o)}function o(){v.animate({path:u[2]},600,null,n)}function n(){f.stop||v.animate({path:c},500,null,i)}function e(){y.animate({path:u[0]},500,null,p)}function p(){y.animate({path:u[1]},500,null,r)}function r(){y.animate({path:u[2]},600,null,s)}function s(){f.stop||y.animate({path:c},500,null,e)}var h=parseInt(this._info.heat-1),l=this.colors[h],c=this.waves[h],m=Raphael(this.div,28,58),f=this;m.setViewBox(0,-40,66,56),m.path("m 56.5,87.987175 a 27.25,6.375 0 1 1 -54.5,0 27.25,6.375 0 1 1 54.5,0 z").attr({"stroke-width":0,fill:"#191E26"}),m.path("M 2.5739855,30.832615 C 2.7998698,41.374652 25.224201,73.827685 29.433321,84.067826 34.793582,72.431012 55.94653,43.176664 56.131043,30.832615 c -1.062271,-39.9612311 -55.0572777,-35.5688568 -53.5570575,0 z").attr({stroke:l,"stroke-width":1.2,fill:"none"});var u=this.waveAniPaths[h],v=m.path(c);v.attr({fill:this.colors2[h],"stroke-width":0,opacity:0}),v.animate({opacity:1},100,"<>",function(){setTimeout(i,400)});var y=m.path(c);if(y.attr({fill:l,"stroke-width":0,opacity:0}),y.animate({opacity:1},100,"<>",function(){e()}),this._info.heat>2){var d=m.circle(30,30,3).attr({fill:l,stroke:"none"});ani=Raphael.animation({cy:-55,opacity:0},1e3),d.animate(ani),d.animate(ani.repeat(1/0));var k=m.circle(30,40,4).attr({fill:l,stroke:"none"});ani2=Raphael.animation({cy:-32,opacity:0},1e3),k.animate(ani2),k.animate(ani2.repeat(1/0));var M=m.circle(30,50,6).attr({fill:l,stroke:"none"});ani3=Raphael.animation({cy:-12,opacity:0},1e3),M.animate(ani3),M.animate(ani3.repeat(1/0)),this.pop=d,this.pop2=k,this.pop3=M}return this._map=t,$(this.div).append('<div class="top-marker-label"><span>'+this._info.label+"</span></div>"),t.getPanes().markerPane.appendChild(this.div),this.div},TopMarker.prototype.draw=function(){if(this._info){var t=this._map.pointToOverlayPixel(new BMap.Point(this._info.x,this._info.y));$(this.div).css({left:t.x-12+"px",top:t.y-50+"px"})}},TopMarker.prototype.addEventListener=function(t,i){$(this.div).on(t,":first",i),$(this.div).on(t,">div>span",i)},TopMarker.prototype.dealloc=function(){this.pop&&this.pop.stop(),this.pop1&&this.pop1.stop(),this.pop2&&this.pop2.stop(),this.stop=!0};
;function Bubble(t){var i={heat:5,label:"",x:0,y:0,bubbleLevel:3,width:29,height:58,interval:50,bubbles:[{r:3,s:[27,30],e:[27,-55],p:4.25},{r:4,s:[27,40],e:[27,-35],p:3.75},{r:6,s:[27,50],e:[27,-15],p:3.25}],wave:{a:6,w:6.28,k:.1,width:26.8593355,height:30.832615},waveTop:[58.069762,51.944762,46.111131,38.509733,30.918412],waveSpeed:[1,1,2,2,4],colors1:["#26D921","#7CB424","#FFEA35","#FF8F35","#FC341E"],colors2:["#17AE12","#639415","#B7A401","#BF5B0B","#952F26"],shadowColor:"#191e26",dropPath:"M 0,30.832615 C 0.2258843,41.374652 22.6502155,73.827685 26.8593355,84.067826 32.2195965,72.431012 53.3725445,43.176664 53.5570575,30.832615 c -1.062271,-39.9612311 -55.0572777,-35.5688568 -53.5570575,0 z",wavePath:" C 0.2258843,41.374652 22.6502155,73.827685 26.8593355,84.067826 32.2195965,72.431012 53.3725445,43.176664 53.5570575,30.832615 z",shadowPath:"m 54,87.987175 a 27.25,6.375 0 1 1 -54.5,0 27.25,6.375 0 1 1 54.5,0 z"};this.options=$.extend(!0,{},i,t),this.init()}Bubble.prototype=new BMap.Overlay,Bubble.prototype.init=function(){var t=$('<div style="position:absolute;cursor:pointer;"></div>'),i=t.get(0);if(this._div=i,this._heat=this.options.heat-1,this._speed=this.options.waveSpeed[this._heat],this._increase=31,this._a=this.options.wave.a,this._w=this.options.wave.w,this._k=this.options.wave.k,this._width=this.options.wave.width,this._height=this.options.wave.height,this._waveTop=this.options.waveTop[this._heat],this._color1=this.options.colors1[this._heat],this._color2=this.options.colors2[this._heat],this._start=0,this._end=Math.floor(2*this.options.wave.width),this._circle=this.options.heat>=this.options.bubbleLevel,this._circle){this._bubbles=[],this._b=[];var e=this.options.bubbles;this._bubbleLength=e.length;for(var s=0,o=this._bubbleLength;o>s;s++)this._bubbles.push({r:e[s].r,sx:e[s].s[0],sy:e[s].s[1],ex:e[s].e[0],ey:e[s].e[1],color:this._color1,speed:e[s].p}),this._b.push([e[s].s[0],e[s].s[1]])}this._t=0},Bubble.prototype.initialize=function(t){var i=this.options;return this._render(),$(this._div).append(T.Util.format('<svg width="#{0}" height="#{1}">#{2}</svg>',i.width,i.height,this._render())),$(this._div).append('<div class="top-marker-label"><span>'+i.label+"</span></div>"),this.animate(),t.getPanes().markerPane.appendChild(this._div),this._map=t,this._div},Bubble.prototype.draw=function(){if(this.options.x&&this.options.y){var t=this._map.pointToOverlayPixel(new BMap.Point(this.options.x,this.options.y));$(this._div).css({left:t.x-12+"px",top:t.y-50+"px"})}},Bubble.prototype.addEventListener=function(t,i){$(this._div).on(t,":first",i),$(this._div).on(t,">div>span",i)},Bubble.prototype.formatStyle=function(t){var i=[];return $.each(t,function(t,e){i.push(T.Util.format("#{0}:#{1};",t,e))}),i.join("")},Bubble.prototype._render=function(){return T.Util.format('<g transform="translate(2,19) scale(0.4)">#{shadow}#{bubbles}#{waves}#{drop}</g>',{shadow:this._renderShadow(),bubbles:this._circle?this._renderBubbles():"",waves:this._renderWaves(),drop:this._renderDrop()})},Bubble.prototype._renderWaves=function(){return T.Util.format('<path class="wave1" style="#{0}"></path><path class="wave2" style="#{1}"></path>',this.formatStyle({fill:this._color2,"stroke-width":0}),this.formatStyle({fill:this._color1,"stroke-width":0}))},Bubble.prototype._renderBubbles=function(){for(var t='<circle cx="#{0}" cy="#{1}" r="#{2}" style="#{3}" />',i=[],e=0,s=this._bubbleLength;s>e;e++){var o=this._bubbles[e];i.push(T.Util.format(t,o.sx,o.sy,o.r,this.formatStyle({fill:o.color,"stroke-width":0,opacity:0})))}var h='<g class="bubbles">#{0}</g>';return T.Util.format(h,i.join(""))},Bubble.prototype._renderShadow=function(){return T.Util.format('<path class="shadow" d="#{0}" style="#{1}"></path>',this.options.shadowPath,this.formatStyle({fill:this.options.shadowColor,"stroke-width":0}))},Bubble.prototype._renderDrop=function(){return T.Util.format('<path class="drop" d="#{0}" style="#{1}"></path>',this.options.dropPath,this.formatStyle({stroke:this._color1,fill:"none","stroke-width":3}))},Bubble.prototype.getBezierPoint=function(t,i,e,s,o,h,r,a,n){for(var p,l=0,b=1,u=.5,_=1/0,d=0;Math.abs(_-d)>.01;)_=i*Math.pow(l,3)+e*l*l+s*l+o-t,d=i*Math.pow(u,3)+e*u*u+s*u+o-t,0>_*d?(b=u,u=.5*(l+u)):(l=u,u=.5*(u+b));return p=Math.round(h*Math.pow(u,3)+r*u*u+a*u+n),new Array(t,p)},Bubble.prototype.bezierRight=function(t){var i=-36.761122,e=47.378061,s=16.080783,o=26.8593355,h=34.527833,r=-52.852602,a=-34.910442,n=84.067826,p=this.getBezierPoint(t,i,e,s,o,h,r,a,n);return p[1]},Bubble.prototype.bezierLeft=function(t){var i=-40.4136581,e=66.5953407,s=.6776529,o=0,h=-44.123888,r=65.732988,a=31.626111,n=30.832615;if(0===t)return n;var p=this.getBezierPoint(t,i,e,s,o,h,r,a,n);return p[1]},Bubble.prototype.bezierTop=function(t){var i=108.4279626,e=-158.7982071,s=-3.186813,o=53.5570575,h=-13.1771229,r=133.0608162,a=-119.8836933,n=30.832615,p=this.getBezierPoint(t,i,e,s,o,h,r,a,n);return p[1]},Bubble.prototype.limitLine=function(t,i){var e,s;return e=this.bezierTop(t),s=t>=this.options.wave.width?this.bezierRight(t):this.bezierLeft(t),i>=e&&s>=i?{y:i,at:0}:e>i?{y:e,at:-1}:i>s?{y:s,at:1}:void 0},Bubble.prototype._drawWave=function(){for(var t=["M 53.5570575,30.832615 L"],i=["M 53.5570575,30.832615 L"],e=this._end;e>=this._start;e--){var s=e,o=.6*Math.sin(this._w*this._t*2*this._speed+.9*this._k*e)*this._a+this._waveTop;t.push(" "),t.push(s),t.push(","),t.push(this.limitLine(s,o).y);var h=e,r=Math.sin(this._w*this._t*this._speed-this._k*e)*this._a+this._waveTop;i.push(" "),i.push(h),i.push(","),i.push(this.limitLine(h,r).y)}return t.push(this.options.wavePath),i.push(this.options.wavePath),this._t=(this._t+this._increase)%27644437,[t.join(""),i.join("")]},Bubble.prototype.animate=function(){var t=this._drawWave();if($(this._div).find(".wave1").attr("d",t[0]),$(this._div).find(".wave2").attr("d",t[1]),this._circle){var i=this._drawCircle();$(this._div).find(".bubbles").children().each(function(t){$(this).attr("cy",i[t].y),$(this).css("opacity",i[t].opacity)})}this._st=setTimeout($.proxy(this,"animate"),this.options.interval)},Bubble.prototype._drawCircle=function(){for(var t=[],i=0,e=this._bubbleLength;e>i;i++){var s=this._bubbles[i],o=s.sy,h=0;this._b[i][1]-=s.speed,this._b[i][1]<=s.sy&&this._b[i][1]>=s.ey?(o=this._b[i][1],h=Math.abs((s.ey-this._b[i][1])/(s.ey-s.sy))):this._b[i][1]<s.ey&&(this._b[i][1]=s.sy+s.speed*(2*(11-this._heat)-7)),t.push({y:o,opacity:h})}return t},Bubble.prototype.dealloc=function(){this._st&&clearTimeout(this._st)};
;function DateList(t,i){this._element=$(t);var e={now:(new Date).getTime(),predictLength:2,dateLength:5,listTpl:'<li><a data-index="#{index}" href="javascript: void(0);"><div class="time-list-date">#{date}</div><div class="time-list-day">#{day}</div></a></li>',onclick:null,holidays:{"元旦":[[1,1]],"腊八节":[[2013,1,19],[2014,1,8]],"除夕":[[2013,2,9],[2014,1,30]],"春节":[[2013,2,10],[2014,1,31]],"元宵节":[[2013,2,24],[2014,2,14]],"情人节":[[2,14]],"妇女节":[[3,8]],"愚人节":[[4,1]],"清明节":[[2013,4,4],[2014,4,5]],"劳动节":[[5,1]],"青年节":[[5,4]],"母亲节":[[2013,5,12],[2014,5,11]],"儿童节":[[6,1]],"端午节":[[2013,6,12],[2014,6,2]],"父亲节":[[2013,6,16],[2014,6,15]],"建军节":[[8,1]],"七夕":[[2013,8,13],[2014,8,2]],"中元节":[[2013,8,21],[2014,8,10]],"教师节":[[9,10]],"中秋节":[[2013,9,19],[2014,9,8]],"国庆节":[[10,1]],"重阳节":[[2013,10,13],[2014,10,2]],"光棍节":[[11,11]],"平安夜":[[12,24]],"圣诞节":[[12,25]]}};this.options=$.extend(!0,{},e,i);var s=[],n=864e5,a=this.options.now+~~this.options.predictLength*n;this.showdate=this.options.showdate;for(var o=this.options.dateLength-1;o>=0;o--)s.push(a-o*n);return this._dateList=s,this.render(),this}DateList.prototype.render=function(){for(var t=function(t,i){if(!t)return null;if(!i)return"";var e=new Date(t),s=e.getFullYear(),n=e.getMonth()+1,a=e.getDate(),o=[];return $.each(i,function(t,i){$.each(i,function(i,e){var h=e[2],d=e[1],r=e[0];h||(h=d,d=r,r=null),r?r==s&&d==n&&h==a&&o.push(t):d==n&&h==a&&o.push(t)})}),o.join("、")},i=["周日","周一","周二","周三","周四","周五","周六"],e=0;e<this.options.dateLength;e++){var s=new Date(this._dateList[e]),n=String(s.getDate()),a=s.getTime()===this.options.now?"今天":t(s,this.options.holidays)||i[s.getDay()];1===n.length&&(data="0"+n),this._element.append(T.Util.format(this.options.listTpl,{index:e,date:[s.getMonth()+1,".",n].join(""),day:a}))}var o=this;return this._element.on("click","a[data-index]",function(t){var i=$(t.currentTarget),e=~~i.attr("data-index"),s=o._dateList[e];o.setActive(s),$.isFunction(o.options.onclick)&&o.options.onclick(s)}),this.showdate&&$.inArray(this.showdate,this._dateList)?this.setActive(this.showdate):this.setActive(this.options.now),this},DateList.prototype.setActive=function(t){this._element.find("a").removeClass("active");for(var i=0;i<this._dateList.length&&t!==this._dateList[i];i++);return this._element.find('a[data-index="'+i+'"]').addClass("active"),this};
;function ZoomControl(o){var t={minZoom:5,maxZoom:14,zoomStep:1,position:{at:BMAP_ANCHOR_TOP_LEFT,x:15,y:20}};this.options=$.extend(!0,{},t,o),this.defaultAnchor=this.options.position.at,this.defaultOffset=new BMap.Size(this.options.position.x,this.options.position.y)}ZoomControl.prototype=new BMap.Control,ZoomControl.prototype.initialize=function(o){this._map=o,this._element=$($("#zoom-control").html()),this._zoomOut=this._element.find(".zoom-out"),this._zoomIn=this._element.find(".zoom-in"),this._zoomBar=this._element.find(".zoom-bar .zoom-bar-active"),this._zoomGrab=this._element.find(".zoom-grab");var t=0,i=57,m=this.options,n=Math.floor((m.maxZoom-m.minZoom)/m.zoomStep),s=n?Math.round((i-t)/n):0,e=t+n*s;if(this._element.height(e+60),this._zoomBar.parent().height(e+18),this._zoomGrab.parent().height(e+20),this._zoomList=[],m.minZoom===m.maxZoom)this._zoomList[m.minZoom]=(e-t)/2;else for(var h=m.minZoom;h<=m.maxZoom;h+=m.zoomStep)this._zoomList[h]=e-s*(h-m.minZoom)/m.zoomStep;this._zoomOut.on("click",$.proxy(this,"_onzoomOut")),this._zoomIn.on("click",$.proxy(this,"_onzoomIn")),this._map.addEventListener("zoomend",$.proxy(this,"setGrab")),this.setGrab(),this._zoomGrab.draggable({addClasses:!1,appendTo:this._element,axis:"y",containment:"parent",grid:[0,s]}),this._zoomGrab.on("drag",$.proxy(this,"_ondrag"));var a=this._element.get(0);return this._map.getContainer().appendChild(a),a},ZoomControl.prototype._ondrag=function(o,t){var i=t.position.top,m=T.Util.indexOf(this._zoomList,i);-1!==m&&this._zoom!==m&&this._map.setZoom(m)},ZoomControl.prototype._onzoomOut=function(){var o=this._zoom-this.options.zoomStep;o<this.options.minZoom||this._map.setZoom(o)},ZoomControl.prototype._onzoomIn=function(){var o=this._zoom+this.options.zoomStep;o>this.options.maxZoom||this._map.setZoom(o)},ZoomControl.prototype.setGrab=function(){this._zoom=this._map.getZoom();var o=~~this._zoomList[this._zoom];"number"==typeof o&&(this._zoomGrab.css("top",o+"px"),this._zoomBar.height(o+~~this._zoomGrab.height()/2))};
;function LegendOverlay(t){var i={position:{at:BMAP_ANCHOR_BOTTOM_RIGHT,x:335,y:58}};this.options=$.extend(!0,{},i,t),this.defaultAnchor=this.options.position.at,this.defaultOffset=new BMap.Size(this.options.position.x,this.options.position.y)}LegendOverlay.prototype=new BMap.Control,LegendOverlay.prototype.initialize=function(t){this._map=t;var i=$($("#legend").html()).get(0);return this._map.getContainer().appendChild(i),i};
;function ComboBox(o,t){this._element=$(o);var e={trigger:"click",list:[],defaultValue:"",listItemTpl:'<li class="combo-box-item" data-value="#{value}"><a href="javascript: void(0);">#{label}</a></li>',listTpl:'<ul class="combo-box-list">#{lists}</ul>',tpl:"",wrapperTpl:'<div class="combo-box-wrapper">#{content}</div>',animateDuration:200,onbeforeOpen:null,onafterOpen:null,onbeforeClose:null,onafterClose:null,onchange:null};return this.options=$.extend(!0,{},e,t),this.init(),this}ComboBox.prototype.init=function(){this._render(),this._value=this.options.defaultValue,this.changeByValue(this.options.defaultValue),this._bindEvents()},ComboBox.prototype._render=function(){var o="",t=this.options;if(t.tpl)$(t.tpl).is('script[type="text/html"]')?o=$(t.tpl).html():$(t.tpl).length&&(o=$("<div>").append($(t.tpl)).html());else{var e=[];$.each(t.list,function(o,n){e.push(T.Util.format(t.listItemTpl,{value:n.value,label:n.label}))}),o=T.Util.format(t.listTpl,{lists:e.join("")})}this._element.append(T.Util.format(t.wrapperTpl,{content:o})),this._dropdown=this._element.find(".combo-box-wrapper")},ComboBox.prototype._bindEvents=function(){if("click"===this.options.trigger){var o=this;this._element.on("mousedown",function(t){o.isOpen()&&t.stopPropagation()}),this._element.on("keydown",function(t){27===t.which&&o.isOpen()&&(o.close(),t.stopPropagation())}),this._element.find(".combo-box-trigger").on("click",$.proxy(this,"toggle")),$("body").on("mousedown",$.proxy(this,"close"))}this.options.tpl||this._element.find(".combo-box-list").on("click",".combo-box-item",$.proxy(this,"_onselect"))},ComboBox.prototype.change=function(o){this._element.find(".combo-box-text").text(o)},ComboBox.prototype._onselect=function(o){this.select($(o.currentTarget).attr("data-value"))},ComboBox.prototype.select=function(o){this._value!==o?(window._hmt&&_hmt.push(["_trackEvent","排序","点击排序",o]),this.changeByValue(o),this._fixReturnValue(this.options.onchange,o)&&this.close()):this.close()},ComboBox.prototype.changeByValue=function(o){this._value=o;var t=this._element.find('.combo-box-list .combo-box-item[data-value="'+o+'"]').text();this.change(t)},ComboBox.prototype.isOpen=function(){return this._element.hasClass("active")},ComboBox.prototype.toggle=function(){this.isOpen()?this.close():this.open()},ComboBox.prototype.open=function(o,t){var t;t=window.ActiveXObject&&!window.XMLHttpRequest?!1:!0,this._onbeforeOpen()&&(this._element.addClass("active"),this._dropdown.stop(!0,!0),t?this._dropdown.slideDown(this.options.animateDuration,$.proxy(this,"_onafterOpen")):(this._dropdown.show(),this._onafterOpen()))},ComboBox.prototype.close=function(o,t){var t;t=window.ActiveXObject&&!window.XMLHttpRequest?!1:!0,this.isOpen()&&this._onbeforeClose()&&(this._element.removeClass("active"),this._dropdown.stop(!0,!0),t?this._dropdown.slideUp(this.options.animateDuration,$.proxy(this,"_onafterClose")):(this._dropdown.hide(),this._onafterClose()))},ComboBox.prototype._onbeforeOpen=function(){return this._fixReturnValue(this.options.onbeforeOpen)},ComboBox.prototype._onafterOpen=function(){$.isFunction(this.options.onafterOpen)&&this.options.onafterOpen()},ComboBox.prototype._onbeforeClose=function(){return this._fixReturnValue(this.options.onbeforeClose)},ComboBox.prototype._onafterClose=function(){$.isFunction(this.options.onafterClose)&&this.options.onafterClose()},ComboBox.prototype._fixReturnValue=function(o){var t=!0;return $.isFunction(o)&&(t=o.apply(this,Array.prototype.slice.call(arguments,1))),t!==!1&&(t=!0),t};
;var ScenicList={init:function(i){var t={emptyTip:"抱歉，暂未获得#{0}景区数据，无法提供景点预测。",onclick:null,ongetData:null};return this.options=$.extend(!0,{},t,i),$("#list").on("click","li",$.proxy(this,"_onclick")),this},onkeydown:function(i){var t=$("#list").find("li.selected");if(t&&t.length){var e=null;switch(i.which){case 38:var e=t.prev("li");break;case 40:var e=t.next("li");break;default:return}if(e&&e.length){var n=this.data[e.data("index")];this.options.onclick&&this.options.onclick(n)}}},_onclick:function(i){var t=$(i.currentTarget).data("index"),e=this.data[t];this.options.onclick&&this.options.onclick(e)},render:function(i,t,e){var n=e.split(",")[0];if(this.data=i,i.length){for(var l="",s=0;s<i.length;s++){var a=i[s];"heat"==n?l+=T.Util.format('<li data-index="#{0}" id="scenic-#{3}"><a href="javascript: void(0);"><span class="scenic" title="#{1}">#{1}</span><span class="scenic-heat heat-#{2}"></span></a></li>',s,a.label,a.heat,a.id):"uv"==n&&(l+=T.Util.format('<li data-index="#{0}" id="scenic-#{3}"><a href="javascript: void(0);"><span class="scenic scenic-name-uv" title="#{1}">#{1}</span><span class="scenic-uv">#{2}人</span></a></li>',s,a.label,T.Util.formatNumber(a.uv),a.id))}$("#list").html(l)}else $("#list").html(T.Util.format('<li class="empty-list">#{0}</li>',T.Util.format(this.options.emptyTip,t.label)))},setHeight:function(i){$(".list-scroll").height(i)},highlightScenic:function(i){$("#list").find("li.selected").removeClass("selected"),$("#list").find("#scenic-"+i.id).addClass("selected")},getHighLight:function(){return $("#list").find("li.selected")}};
;var SideBar={init:function(s){return this.options=s||{},this._side=$("#side"),this._side.find(".side-toggle").on("click",$.proxy(this,"toggle")),this},toggle:function(){this._side.toggleClass("close"),this.options.ontoggle&&this.options.ontoggle(this.isClosed())},isClosed:function(){return this._side.hasClass("close")}};
;function AreaList(t,i){this._element=$(t);var e={areaList:{},groupTpl:'<div class="area-group"><div class="area-group-name">#{groupName}：</div><div class="area-group-list">#{groupList}</div></div>',listTpl:'<a href="javascript: void(0);" class="area-group-item" data-group="#{group}" data-item="#{item}" data-id="#{id}">#{label}</a>',wrapperTpl:'<div class="area-list">#{content}</div>',onclick:null};return this.options=$.extend(!0,{},e,i),this.init(),this}AreaList.prototype.init=function(){this._render(),this._bindEvents()},AreaList.prototype._render=function(){var t=this.options,i=[];$.each(t.areaList,function(e,a){var r=[];$.each(a.children,function(i,a){r.push(T.Util.format(t.listTpl,{label:a.label,group:e,item:i,id:a.id}))}),i.push(T.Util.format(t.groupTpl,{groupName:a.label,groupList:r.join("")}))}),this._element.html(T.Util.format(t.wrapperTpl,{content:i.join("")}))},AreaList.prototype._bindEvents=function(){this._element.on("click",".area-group-item",$.proxy(this,"_onclick"))},AreaList.prototype._onclick=function(t){var i=$(t.currentTarget),e=i.attr("data-group"),a=i.attr("data-item"),r=this.options.areaList[e].children[a];window._hmt&&_hmt.push(["_trackEvent","省市列表","点击省市",r.label]),$.isFunction(this.options.onclick)&&this.options.onclick(r)},AreaList.prototype.getProvince=function(t){var i=this._element.find('.area-group-item[data-id="'+t+'"]');if(i.length){var e=i.attr("data-group"),a=i.attr("data-item");return this.options.areaList[e].children[a]}return void 0},AreaList.prototype.hide=function(){this._element.hide()},AreaList.prototype.show=function(){this._element.show()};
;function SearchBox(t,e){this._element=$(t);var i={searchDelay:700,keydownKeyCode:[8,46,32,48,49,50,51,52,53,54,55,56,57,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90],loadingHtml:'<div class="search-loading">搜索中……</div>',tipTpl:'<div class="search-tip">#{0}</div>',emptyTip:"啊哦，没找到你要的景点或省份。目前我们只提供全国5A景点拥挤预测服务。",listTpl:'<ul class="search-list">#{0}</ul>',itemTpl:'<li class="search-item #{className}" data-index="#{index}">#{label}</li>',wordTpl:'<span class="search-word">#{0}</span>',scenicTpl:'<span class="search-scenic">#{scenic}</span>&emsp;-&emsp;#{province}',provinceTpl:'<span class="search-province">#{0}</span>',onsearch:null,oncancel:null,onclick:null,onnext:null,onprev:null};return this.options=$.extend(!0,{},i,e),this.init(),this}SearchBox.prototype.init=function(){this._input=this._element.find(".search-input"),this._close=this._element.find(".search-close"),this._button=this._element.find(".search-button"),this._result=this._element.find(".search-result"),this._needPlaceholder=!("placeholder"in document.createElement("input")),this._hasInputEvent="oninput"in document.createElement("input"),this._debounce=0,this._timeout=null,this._ready=!1,this._value="",this._data=[],this._input.toggleClass("with-placeholder",this._needPlaceholder),this._bindEvents()},SearchBox.prototype._bindEvents=function(){this._close.on("click",$.proxy(this,"reset")),this._button.on("click",$.proxy(this,"_onbutton")),this._input.on("focus",$.proxy(this,"_onfocus")).on("blur",$.proxy(this,"_onblur")).on("input",$.proxy(this,"_oninput")).on("keydown",$.proxy(this,"_onkeydown")).on("keyup",$.proxy(this,"_onkeyup")),this._result.on("mouseenter",".search-item",$.proxy(this,"_onhover")).on("click",".search-item",$.proxy(this,"_onclick")),$(document).on("click",$.proxy(this,"close"))},SearchBox.prototype.close=function(t){T.Util.clickInContainer(t.target,$(".search-container").get(0))||(this.reset(),this._input.blur())},SearchBox.prototype._checkPlaceholder=function(t){this._input.toggleClass("with-placeholder",this._needPlaceholder&&!t)},SearchBox.prototype.reset=function(){this._ready=!1,this._timeout&&clearTimeout(this._timeout),this._result.empty().parent().hide(),this._element.removeClass("active"),this._close.removeClass("search-close-active"),this._needPlaceholder?this._input.val(this._input.attr("value")):this._input.val(""),this._value="",this._checkPlaceholder(),$.isFunction(this.options.oncancel)&&this.options.oncancel()},SearchBox.prototype.focus=function(){this._input.focus()},SearchBox.prototype._onfocus=function(){this._input.addClass("focus-search-input"),this._input.val("")},SearchBox.prototype._onblur=function(){this._input.removeClass("focus-search-input"),this._input.val(this._input.attr("value"))},SearchBox.prototype._onbutton=function(){var t=this._input.val(),e=(new Date).getTime();this._timeout&&clearTimeout(this._timeout),this._debounce=e,this._onsearch({value:t})},SearchBox.prototype._oninput=function(t){var e=$(t.target).val();this._checkPlaceholder(e);var i=""!==$.trim(e);this._element.toggleClass("active",i),this._close.toggleClass("search-close-active",i);var o=(new Date).getTime();o-this._debounce<this.options.searchDelay&&this._timeout&&clearTimeout(this._timeout),this._timeout=setTimeout($.proxy(this,"_onsearch",{value:e}),this.options.searchDelay),this._debounce=o},SearchBox.prototype._onsearch=function(t){var e=$.trim(t.value);this._value=e,e?(this._ready=!0,$.isFunction(this.options.onsearch)&&this.options.onsearch(e)):this.reset()},SearchBox.prototype._onkeydown=function(t){switch(t.which){case 13:t.preventDefault(),t.stopPropagation();var e=this._result.find(".search-item.focus");e.length?this._onclick(t,e):this._onbutton();break;case 38:this._prev(),t.preventDefault(),t.stopPropagation();break;case 40:this._next(),t.preventDefault(),t.stopPropagation();break;case 27:this._value.length&&(this.reset(),t.preventDefault(),t.stopPropagation())}},SearchBox.prototype._onkeyup=function(t){return T.Util.contains(this.options.keydownKeyCode,t.which)?((!this._hasInputEvent||this._needPlaceholder&&this._hasInputEvent&&T.Util.contains([8,46],t.which))&&this._oninput(t),void 0):(t.preventDefault(),t.stopPropagation(),void 0)},SearchBox.prototype.loading=function(){this._result.html(this.options.loadingHtml).parent().show()},SearchBox.prototype.tip=function(t){this._ready&&this._result.html(T.Util.format(this.options.tipTpl,t)).parent().show()},SearchBox.prototype._renderWord=function(t,e){var i=new RegExp(t.replace(/([\\\/\?\(\)\[\]\^\$\-\*\+\.])/g,"\\$1"),"gi");return e.replace(i,T.Util.format(this.options.wordTpl,t))},SearchBox.prototype.render=function(t){if(this._ready){var e=[],i=[],o=this;if($.each(t,function(s,n){var r={};if("undefined"==typeof n.id){var a=T.Util.format(o.options.provinceTpl,o._renderWord(o._value,n.province));r.isProvince=!0,r.zoom=n.zoom}else{var a=T.Util.format(o.options.scenicTpl,{province:n.province,scenic:o._renderWord(o._value,n.label)});r.id=n.id,r.label=n.label}r.province=n.province,r.provinceId=n.provinceId,r.x=n.x,r.y=n.y,e.push(r),i.push(T.Util.format(o.options.itemTpl,{index:s,label:a,className:0===s?"first":s===t.length-1?"last":""}))}),this._data=e,!t.length)return this.tip(this.options.emptyTip),void 0;var s=T.Util.format(this.options.listTpl,i.join(""));this._result.html(s).parent().show()}},SearchBox.prototype._focus=function(t){this._result.find(".search-item").removeClass("focus").eq(t).addClass("focus")},SearchBox.prototype._prev=function(){var t=this._result.find(".search-item"),e=t.filter(".focus"),i=t.index(e)-1;if(i>=0){e.removeClass("focus");var o=t.eq(i);o.addClass("focus"),$.isFunction(this.options.onprev)&&this.options.onprev({index:i,length:this._data.length,dom:o})}},SearchBox.prototype._next=function(){var t=this._result.find(".search-item"),e=t.filter(".focus"),i=t.index(e)+1;if(i<t.length){e.removeClass("focus");var o=t.eq(i);o.addClass("focus"),$.isFunction(this.options.onnext)&&this.options.onnext({index:i,length:this._data.length,dom:o})}},SearchBox.prototype._onhover=function(t){var e=$(t.currentTarget),i=e.attr("data-index");this._focus(i)},SearchBox.prototype._onclick=function(t,e){var e=e||$(t.currentTarget),i=e.attr("data-index");$.isFunction(this.options.onclick)&&this.options.onclick(this._data[i]),this.reset(),this._input.blur()};
;function ScrollBar(t,i){var o={wheelSpeed:20,minScrollbarLength:20,scrollBarGrabTpl:'<div class="scroll-bar-grab"></div>',scrollBarRailTpl:'<div class="scroll-bar-rail"></div>',scrollBarLineTpl:'<div class="scroll-bar-line"></div>',className:"scroll-bar",scrollElement:""};return this.options=$.extend(!0,{},o,i),this._element=$(t),this.init(),this}ScrollBar.prototype.init=function(){this._render(),this._grab=this._element.find(".scroll-bar-grab"),this._rail=this._element.find(".scroll-bar-rail"),this._line=this._element.find(".scroll-bar-line"),this._scroll=this._element.find(this.options.scrollElement).addClass("scroll-bar-item"),this._inHeight=this._scroll.outerHeight(!0),this._outHeight=this._element.height(),this._top=0,this._scrollTop=0,this._barHeight=this._rail.height()-this._grab.height(),this._scrollHeight=Math.max(this._inHeight-this._outHeight,0),this._grab.draggable({addClasses:!1,appendTo:this._rail,axis:"y",containment:"parent"}),this._bindEvents(),this.refresh()},ScrollBar.prototype._render=function(){if(!this._element.hasClass(this.options.className)){var t=$(this.options.scrollBarRailTpl).append(this.options.scrollBarLineTpl).append(this.options.scrollBarGrabTpl);this._element.addClass(this.options.className).append(t)}},ScrollBar.prototype._bindEvents=function(){this._element.on("mousewheel",$.proxy(this,"_onmousewheel")),this._grab.on("drag",$.proxy(this,"_ondrag")).on("click",$.proxy(this,"_onclickGrab")),this._rail.on("click",$.proxy(this,"_onclick"))},ScrollBar.prototype._onclickGrab=function(t){t.preventDefault(),t.stopPropagation()},ScrollBar.prototype._ondrag=function(t){this.scrollBarTo(this._grab.position().top),t.stopPropagation()},ScrollBar.prototype._onclick=function(t){this.scrollBarTo(Math.floor(t.offsetY-this._grab.height()/2)),t.preventDefault(),t.stopPropagation()},ScrollBar.prototype._onmousewheel=function(t){this.scrollTo(this._scrollTop-this.options.wheelSpeed*t.deltaY),t.preventDefault(),t.stopPropagation()},ScrollBar.prototype.refresh=function(){this._inHeight=this._scroll.outerHeight(!0),this._outHeight=this._element.height();var t=this._inHeight,i=this._outHeight;i>=t?this._hide():(this._show(),this._calcRailHeight(),this._calcGrabHeight(),this._barHeight=this._rail.height()-this._grab.height(),this._scrollHeight=this._inHeight-this._outHeight,this.scrollTo(0))},ScrollBar.prototype._calcGrabHeight=function(){this._grab.height(this._inHeight<=this._outHeight?0:Math.max(this._outHeight/this._inHeight*this._rail.height(),this.options.minScrollbarLength))},ScrollBar.prototype._calcRailHeight=function(){this._rail.add(this._line).height(this._element.height())},ScrollBar.prototype._show=function(){this._rail.show()},ScrollBar.prototype._hide=function(){this._rail.hide()},ScrollBar.prototype._setTop=function(t,i){var i=parseInt(i);return i!==i&&(i=0),t.css("top",[i,"px"].join(""))},ScrollBar.prototype.scrollBarTo=function(t){this.scrollTo(t/this._barHeight*this._scrollHeight)},ScrollBar.prototype.scrollTo=function(t){var t=parseInt(t);t===t&&(0>t&&(t=0),t>this._scrollHeight&&(t=this._scrollHeight),this._scrollTop=t,this._setTop(this._scroll,-this._scrollTop),this._top=this._scrollTop/this._scrollHeight*this._barHeight,this._setTop(this._grab,this._top))},ScrollBar.prototype.scrollTop=function(){return this._scrollTop},ScrollBar.prototype.height=function(){return this._element.height()},ScrollBar.prototype.visible=function(t){return t.position().top-this._scrollTop<0?-1:this._outHeight+this._scrollTop-t.position().top-t.outerHeight()<0?1:0},ScrollBar.prototype.scrollHeight=function(){return this._outHeight};
;function Dialog(t){var o={width:426,height:"auto",showTitle:!0,title:"",autoHide:0,showButton:!1,buttonText:"提交",html:"",modal:!0,selector:null,className:"",onsubmit:null};this.options=$.extend(!0,{},o,t),this._initDialog()}Dialog.prototype._initDialog=function(){var t=this.options,o={appendTo:"body",autoFocus:!1,autoOpen:!1,close:$.proxy(this,"_onclose"),closeOnEscape:!0,closeText:"关闭",dialogClass:t.showTitle?t.className:t.className+" hide-title",draggable:!0,height:t.height,hide:null,maxHeight:!1,maxWidth:!1,minHeight:115,minWidth:115,modal:t.modal,position:{my:"center",at:"center",of:window},resizable:!0,show:null,title:t.title,width:t.width};t.showButton&&(o.buttons=[{text:t.buttonText,click:$.proxy(this,"_onsubmit")}]);var i=null;t.selector?(i=$(t.selector),"text/html"===i.attr("type")&&(i=$(i.html()))):i=$("<div>").html(t.html),this._dialog=i.dialog(o),this._bindEvents()},Dialog.prototype._onsubmit=function(){$.isFunction(this.options.onsubmit)&&this.options.onsubmit()},Dialog.prototype.close=function(){return this._st&&clearTimeout(this._st),this._dialog.dialog("close"),this},Dialog.prototype.open=function(){return this._dialog.dialog("option","position",{my:"center",at:"center",of:window}),this._dialog.dialog("open"),this._focusTabbable(),this.options.autoHide&&(this._st=setTimeout($.proxy(this,"close"),this.options.autoHide)),this},Dialog.prototype.distory=function(){return this._st&&clearTimeout(this._st),this._dialog.dialog("destory"),this},Dialog.prototype.isOpen=function(){return this._dialog.dialog("isOpen")},Dialog.prototype._focusTabbable=function(){var t=this._dialog.find("[autofocus]");t.length||(t=this._dialog.find(":tabbable")),t.length||(t=this._dialog.parent().find(".ui-dialog-buttonpane").find(":tabbable")),t.length||(t=this._dialog.parent().find(".ui-dialog-titlebar").find(":tabbable")),t.length||(t=this._dialog),t.eq(0).focus()},Dialog.prototype._onclose=function(t){t.stopPropagation()},Dialog.prototype._bindEvents=function(){var t=this;$(window).resize(function(){t._dialog.dialog("option","position",{my:"center",at:"center",of:window})})};
;!function(t){"use strict";t.widget("ui.inlinetip",{version:"1.0.0",options:{color:"#a1a1a1"},_create:function(){if(this._placeholder="placeholder"in document.createElement("input"),!this._placeholder){var e=this.options.color;this.element.each(function(){var r=t(this),o=r.attr("placeholder");o&&(r.attr("data-placeholder-color",r.css("color")||"inherit"),""==t.trim(r.val())&&(r.val(o),r.css("color",e)))}),this._bindEvents()}},_bindEvents:function(){this.element.on("focus",t.proxy(this,"_focus")),this.element.on("blur",t.proxy(this,"_blur"))},_focus:function(e){var r=t(e.currentTarget);t.trim(r.val())==r.attr("placeholder")&&(r.css("color",r.attr("data-placeholder-color")||"inherit"),r.val(""))},_blur:function(e){var r=t(e.currentTarget);""==t.trim(r.val())&&(r.css("color",this.options.color),r.val(r.attr("placeholder")))},value:function(){var e=this.element.attr("placeholder"),r=t.trim(this.element.val());return this._placeholder?r:e?r===e?"":r:r},reset:function(){return this._placeholder?(this.element.val(""),void 0):(this.element.val(this.element.attr("placeholder")),this.element.css("color",this.options.color),void 0)}})}(jQuery);
;function LogoOverlay(o){var t={point:null,logoUrl:"/static/trends_travel/image/tour/map_logo_5d73718.png",logoWidth:186,logoHeight:64};this.options=$.extend(!0,{},t,o)}LogoOverlay.prototype=new BMap.Overlay,LogoOverlay.prototype.initialize=function(o){this._map=o;var t=this._logo=$(T.Util.format("<div style=\"background-image:url(#{src});background-repeat:none;_filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='#{src}');_background-image:none;position:absolute;width:#{width}px;height:#{height}px;\"></div>",{src:this.options.logoUrl,width:this.options.logoWidth,height:this.options.logoHeight})).get(0);return this._map.getPanes().labelPane.appendChild(t),legend},LogoOverlay.prototype.draw=function(){var o=this._map.pointToOverlayPixel(this.options.point);this._logo.style.left=o.x-this.options.logoWidth/2+"px",this._logo.style.top=o.y-this.options.logoHeight/2+"px"};
;var mapOptions={minZoom:5,maxZoom:14,zoomStep:1,startZoom:5,scenicZoom:12,startPoint:{x:104.114129,y:37.550339},mapStyle:{features:["road","building","water","land"],style:"dark"},zoomControlPosition:{at:BMAP_ANCHOR_TOP_LEFT,x:15,y:20},legendPosition:{at:BMAP_ANCHOR_BOTTOM_RIGHT,x:335,y:20}},travelPage={config:T.config,timestamp:null,today:null,provinceId:null,orderby:null,init:function(){this.timestamp=this.config.systemConfig.now,this.today=this.timestamp,this.provinceId=this.config.pageInfo.provinceId||this.config.pageInfo.defaultArea,this.orderby=this.config.pageInfo.defaultOrder,this.listScroll=new ScrollBar(".list-scroll",{scrollElement:"#list"}),this.sideBar=SideBar.init({ontoggle:$.proxy(this,"setMapOffset")}),this.scenicList=ScenicList.init({onclick:$.proxy(this,"changeScenic")}),this.setMapSize(),$(window).on("resize",$.proxy(this,"setMapSize")),this.dateList=new DateList(".time-list",{now:this.timestamp,showdate:this.config.systemConfig.showdate,onclick:$.proxy(this,"changeDate")}),this.travelMap=TravelMap.init($.extend({},mapOptions,{viewTrends:$.proxy(this,"getTrends"),viewProvince:$.proxy(this,"changeProvinceById"),afterFocusScenic:$.proxy(this,"highlightScenic"),zoomChange:$.proxy(this,"zoomChange")})),this.sortComboBox=new ComboBox(".combo-box.order",{list:this.config.orderList,defaultValue:this.orderby,onchange:$.proxy(this,"changeOrder")}),this.areaListComboBox=new ComboBox(".combo-box.search",{tpl:"#search-combo-box"}),this.areaList=new AreaList(".area-list-container",{areaList:this.config.areaList,onclick:$.proxy(this,"changeProvince")}),this.searchBox=new SearchBox(".search-container",{onsearch:$.proxy(this,"onsearch"),oncancel:$.proxy(this,"cancelSearch"),onclick:$.proxy(this,"clickSearch"),onprev:$.proxy(this,"scrollSearch"),onnext:$.proxy(this,"scrollSearch")}),this.searchScroll=new ScrollBar(".search-scroll",{scrollElement:".search-result"}),this.initDialog(),$("input[name], textarea[name]").inlinetip(),$(".back-to").on("click",$.proxy(this,"backToNationWide")),$(document).on("keydown",$.proxy(this,"setShortcuts")),this.changeProvinceById(this.provinceId,this.config.pageInfo.scenicId),this.config.pageInfo.logo===!0&&this.initLogo()},initLogo:function(){this.travelMap.showLogo()},initDialog:function(){this.dialog={about:new Dialog({title:"关于旅游预测",selector:"#about",width:750,height:500}),feedback:new Dialog({title:"用户反馈",selector:"#feedback",showButton:!0,buttonText:"提交反馈",onsubmit:$.proxy(this,"onFeedback")}),cooperation:new Dialog({title:"景点合作",selector:"#cooperation",showButton:!0,buttonText:"提交需求",onsubmit:$.proxy(this,"onCooperation")}),tip:new Dialog({showTitle:!1,autoHide:2e3,modal:!1,html:'<div class="tip-dialog">提交成功！</div>'})},$(".about").on("click",$.proxy(this,"openDialog","about")),$(".feedback").on("click",$.proxy(this,"openFeedback")),$(".cooperation").on("click",$.proxy(this,"openDialog","cooperation"))},openDialog:function(t){$.each(this.dialog,function(t,e){e.isOpen()&&e.close()}),this.dialog[t].open()},validate:function(t){var e=!0;return t.find("input[name][required], textarea[name][required]").each(function(){var t=$(this);""===t.inlinetip("value")&&(e=!1,t.on("focus",function(t){$(t.currentTarget).parent().removeClass("form-line-error")}).parent().addClass("form-line-error"))}),e},getFormData:function(t){var e={};return t.find("input[name], textarea[name]").each(function(){var t=$(this);t.is("input[placeholder]")?(e[t.attr("name")]=t.inlinetip("value"),t.inlinetip("reset")):e[t.attr("name")]=t.val()}),e.url=window.location.href,e},onFeedback:function(){var t=$(".feedback-dialog");this.validate(t)&&(this.getData(this.config.ajaxUrls.feedbackUrl,this.getFormData(t),$.proxy(this,"showSuccessTip"),$.proxy(this,"showFailedTip")),this.dialog.feedback.close())},onCooperation:function(){var t=$(".cooperation-dialog");this.validate(t)&&this.dealWithCrossProxy()},dealWithCrossProxy:function(){var t=this.getCooperNecData(),e="",i="fb_qa_feedback_frame_id";$("#fb_qa_feedback_frame_id").remove();var o=$('<iframe id="fb_qa_feedback_frame_id"></iframe>');o.appendTo("body"),o.css("display","none"),o.attr("name",i),o[0].contentWindow.name=i;var a=$('<form id="fb_right_post_form"></form>');a.attr("action","http://f3.baidu.com/index.php/feedback/zx/GetData"),a.attr({enctype:"multipart/form-data",target:i,method:"POST"});var n=$("<input />");n.attr({type:"hidden",name:"necData",value:JSON.stringify(t)}),a.append(n);var s=$("<input />");s.attr({type:"hidden",name:"proData",value:JSON.stringify(e)}),a.append(s),a.submit();var r=this;o.load(function(){r.showSuccessTip(),r.dialog.cooperation.close(),$(".cooperation-dialog input, .cooperation-dialog textarea").val(""),$("#fb_qa_feedback_frame_id").contents().find("#fb_right_post_form").remove(),$("#fb_qa_feedback_frame_id").remove()})},getCooperNecData:function(){var t=$("#cooperation-name").val()||"",e=$("#cooperation-people").val()||"",i=$(".cooper-box-textarea").val()||"",o=$("#cooperation-content").val()||"",a=["景点名称:"+t,"联系人:"+e,"合作需求:"+i],n={product_id:168,userAgent:navigator.userAgent,issuedesc:a.join(", "),email:o,documentcookie:document.cookie,url:document.location.href};return n},showSuccessTip:function(){$(".tip-dialog").removeClass("tip-dialog-error").text("提交成功！"),this.openDialog("tip")},showFailedTip:function(t){$(".tip-dialog").addClass("tip-dialog-error").text(t),this.openDialog("tip")},zoomChange:function(){var t=this.areaList.getProvince(this.provinceId);this.travelMap.zoomChangeRender(t.zoom)},setMapSize:function(){var t=$(window).height();$("#map-container, #side").height(t-60),this.onresizeMap(t)},backToNationWide:function(){this.changeProvinceById(this.config.pageInfo.defaultArea)},setShortcuts:function(t){return t.ctrlKey&&70===t.which?(t.preventDefault(),t.stopPropagation(),this.areaListComboBox.toggle(),void 0):27===t.which?(t.preventDefault(),t.stopPropagation(),this.isNationWide()||this.backToNationWide(),void 0):((38===t.which||40===t.which)&&(t.preventDefault(),t.stopPropagation(),this.scenicList.onkeydown(t),this.scrollList()),void 0)},scrollList:function(){var t=this.scenicList.getHighLight();if(t&&t.length){var e=this.listScroll.visible(t);e>0?this.listScroll.scrollTo(t.position().top-this.listScroll.scrollHeight()+t.outerHeight(!0)):0>e&&this.listScroll.scrollTo(t.position().top)}},highlightScenic:function(t){this.scenicList.highlightScenic(t),this.scrollList()},onresizeMap:function(t){this.scenicList.setHeight(t-190),this.listScroll.refresh()},isNationWide:function(){return this.provinceId==this.config.pageInfo.defaultArea},getData:function(t,e,i,o,a){"function"==typeof e&&(e={},o=i,i=e),$.ajax({type:"POST",url:t,dataType:"json",data:e,success:function(t){1==t.status?o&&o(t.msg,{orginalData:t,postData:e,extData:a}):i&&i(t.data,{orginalData:t,postData:e,extData:a})},fail:o})},getScenics:function(t){var e=this.config.systemConfig.showdate?this.config.systemConfig.showdate:this.timestamp,i={provinceId:this.provinceId,timestamp:e>1437191757e3?Math.random()>.5?1437191757e3:1437105357e3:e,orderby:this.orderby};this.config.systemConfig.showdate="",this.listScroll.scrollTo(0),this.getData(this.config.ajaxUrls.scenicsUrl,i,$.proxy(this,"ongetScenicsSuccess"),null,t)},ongetScenicsSuccess:function(t,e){for(var i=this.isNationWide(),o=0;o<t.length;o++){var a=t[o].heat;t[o].nationwide=i,t[o].closed=0==a,t[o].heat=a||1}for(var n=[],s=0;s<t.length;s++)t[s].hide!==!0&&n.push(t[s]);if(this.travelMap.render(n,e.postData.provinceId),this.scenicList.render(t,this.areaList.getProvince(e.postData.provinceId),e.postData.orderby),this.listScroll.refresh(),"undefined"!=typeof e.extData)for(var o=0,r=t.length;r>o;o++)if(t[o].id==e.extData)return this.changeScenic(t[o]),this.scrollList(),void 0},getTrends:function(t){var e={scenicId:t,timestamp:this.timestamp};this.getData(this.config.ajaxUrls.trendUrl,e,$.proxy(this,"ongetTrendsSuccess"))},ongetTrendsSuccess:function(t){this.travelMap.showTrends(t,this.timestamp,this.today)},setMapOffset:function(t){this.travelMap.setLegendOffset(mapOptions.legendPosition.x-(t?320:0)),this.travelMap.setCenterOffset(t),$(".back-to").toggleClass("back-to-slide",t)},changeDate:function(t){var e=new Date(t),i=e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate();window._hmt&&_hmt.push(["_trackEvent","地图","时间切换",i]),this.timestamp=t,this.travelMap.isShowTip()?this.getScenics(this.travelMap.getCurrentScenicId()):this.getScenics()},changeOrder:function(t){this.orderby=t,this.getScenics(),this.travelMap.focusProvince(this.areaList.getProvince(this.provinceId))},changeProvinceById:function(t,e){this.changeProvince(this.areaList.getProvince(t),e)},changeProvince:function(t,e){this.provinceId=t.id,this.areaListComboBox.close(),this.areaListComboBox.change(t.label),this.getScenics(e),this.travelMap.focusProvince(t),$(".back-to").toggleClass("back-to-show",!this.isNationWide())},changeScenic:function(t){window._hmt&&_hmt.push(["_trackEvent","右侧","点击景点",t.label]),t.hide!==!0?(this.travelMap.focusScenic(t),this.showScenicTip(t)):this.changeProvinceById(t.provinceId,t.id)},showScenicTip:function(t){this.travelMap.showTip(t)},clickSearch:function(t){t.label?window._hmt&&_hmt.push(["_trackEvent","搜索","点击景点",t.label]):window._hmt&&_hmt.push(["_trackEvent","搜索","点击省市",t.province]),this.changeProvinceById(t.provinceId,t.id)},scrollSearch:function(t){var e=this.searchScroll.visible(t.dom);e>0?this.searchScroll.scrollTo(this.searchScroll.scrollTop()+t.dom.outerHeight()+(t.dom.outerHeight(!0)-t.dom.outerHeight())/(t.index===t.length-1?1:2)):0>e&&this.searchScroll.scrollTo(t.dom.position().top+(0===t.index?0:10))},onsearch:function(t){this.areaList.hide(),this.searchBox.loading(),this.query(t),this.searchScroll.scrollTo(0)},onsearchSuccess:function(t){this.searchBox.render(t),this.searchScroll.refresh()},onsearchFailed:function(t){this.searchBox.tip(t),this.searchScroll.refresh()},resetSearch:function(){this.searchBox.reset(),this.areaList.show()},startSearch:function(){this.searchBox.focus()},cancelSearch:function(){this.areaList.show()},query:function(t){var e={word:t,timestamp:this.timestamp};this.getData(this.config.ajaxUrls.queryUrl,e,$.proxy(this,"onsearchSuccess"),$.proxy(this,"onsearchFailed"))},openFeedback:function(){if(window.bds)this.initFeedback();else{var t=this;this.loadScript("http://f3.baidu.com/feedback/js/feedback/feedback0.0.2.js",function(){t.initFeedback()},{charset:"utf-8",id:"feedback_script"})}},initFeedback:function(){if(bds&&bds.qa&&bds.qa.ShortCut&&bds.qa.ShortCut.initRightBar){var t={product_id:168,showPosition:"center"},e={product_id:168};bds.qa.ShortCut.initRightBar(t,e)}},loadScript:function(t,e,i){var o=document.createElement("script"),i=i||{};o.type="text/javascript",i.charset&&(o.charset=i.charset),i.id&&(o.id=i.id),o.readyState?o.onreadystatechange=function(){("loaded"===o.readyState||"complete"===o.readyState)&&(o.onreadystatechange=null,e())}:o.onload=function(){e()},o.src=t,document.body.appendChild(o)}};travelPage.init();